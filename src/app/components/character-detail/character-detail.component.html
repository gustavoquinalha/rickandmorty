<div class="w-full min-h-[calc(100dvh-4rem)]">
  <div
    class="flex justify-center items-center fixed md:sticky top-[calc(100%-4rem)] md:top-0 left-0 z-50 border-t md:border-t-0 border-b-0 md:border-b w-full backdrop-blur-sm bg-background/95"
  >
    <div class="container flex justify-between items-center gap-2 h-16">
      <div class="flex items-center gap-2">
        <a routerLink="/" class="btn btn-border">
          <span class="text-lg leading-none">👈</span>
          <span class="hidden md:block">Back</span>
        </a>

        <span
          class="text-sm md:ml-2 truncate whitespace-nowrap block text-muted-foreground"
        >
          Character {{ characterId }}</span
        >
      </div>

      <div class="flex justify-between items-center gap-2">
        <button
          *ngIf="character"
          (click)="toggleFavorite($event, character.id)"
          class="btn bg-background/60 backdrop-blur-sm h-10 w-10 text-lg leading-none border"
        >
          {{ isFavorite(character.id) ? "❤️" : "🤍" }}
        </button>

        <button
          [ngClass]="{ disabled: characterId <= 1 }"
          (click)="goToPreviousCharacter()"
          class="btn btn-border w-10 md:w-auto px-0 md:px-3"
        >
          <span class="text-lg leading-none">👈</span>
          <span class="hidden md:block">Previous character</span>
        </button>

        <button
          [ngClass]="{ disabled: this.characterId >= this.maxCharacters }"
          (click)="goToNextCharacter()"
          class="btn btn-border w-10 md:w-auto px-0 md:px-3"
        >
          <span class="hidden md:block">Next character</span>
          <span class="text-lg leading-none">👉</span>
        </button>
      </div>
    </div>
  </div>

  <ng-container
    *ngIf="
      !loadingCharacter && !loadingLocation && !loadingEpisodes;
      else loading
    "
  >
    <div
      *ngIf="character; else empty"
      class="container flex flex-col gap-4 justify-center items-center py-8"
    >
      <div
        class="group w-full max-w-2xl relative border rounded-xl text-foreground transition-all p-6 flex flex-col gap-6 bg-input/50 overflow-hidden"
      >
        <div class="flex gap-6 items-start flex-col md:flex-row">
          <img
            [src]="character.image"
            alt="{{ character.name }}"
            class="w-full h-auto md:w-48 min-w-48 md:h-48 rounded-xl border"
          />

          <div
            class="overflow-hidden truncate w-full h-full flex gap-2 flex-col justify-end"
          >
            <div class="w-full">
              <h3
                class="text-3xl font-bold text-foreground tracking-widest font-creepster whitespace-normal"
              >
                {{ character.name }}
              </h3>
            </div>

            <div class="flex flex-col gap-2">
              <div
                class="whitespace-normal capitalize"
                [title]="character.status"
                *ngIf="character.status"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Status:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2">{{
                  character.status === "Alive"
                    ? "😄"
                    : character.status === "Dead"
                    ? "😵"
                    : "🤔"
                }}</span>
                <span class="text-sm">{{ character.status }}</span>
              </div>

              <div
                class="whitespace-normal capitalize"
                [title]="character.gender"
                *ngIf="character.gender"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Gender:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2">{{
                  character.gender === "Female"
                    ? "👩"
                    : character.gender === "Male"
                    ? "👨"
                    : character.gender === "Genderless"
                    ? "🌳"
                    : "🤔"
                }}</span>
                <span class="text-sm">{{ character.gender }}</span>
              </div>

              <div
                class="whitespace-normal capitalize"
                [title]="character.species"
                *ngIf="character.species"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Specie:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2">{{
                  character.species === "Human"
                    ? "🌎"
                    : character.species === "Alien"
                    ? "👽"
                    : character.species === "Robot"
                    ? "🤖"
                    : character.species === "Animal"
                    ? "🐶"
                    : character.species === "Cronenberg"
                    ? "🐙"
                    : character.species === "Humanoid"
                    ? "🐲"
                    : character.species === "Poopybutthole"
                    ? "🥒"
                    : character.species === "Mythological Creature"
                    ? "🪄"
                    : character.species === "unknown"
                    ? "🤔"
                    : character.species
                }}</span>
                <span class="text-sm">{{ character.species }}</span>
              </div>

              <div
                class="whitespace-normal capitalize"
                title="Type"
                *ngIf="character.type"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Type:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2"
                  >🔎</span
                >
                <span class="text-sm">{{ character.type }}</span>
              </div>

              <div
                class="whitespace-normal capitalize"
                title="location"
                *ngIf="character.location"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Location:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2"
                  >📌</span
                >
                <span class="text-sm">{{ character.location.name }}</span>
              </div>

              <!-- <div
                class="whitespace-normal capitalize"
                title="Location"
                *ngIf="character.location.name"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Location:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2"
                  >📌</span
                >
                <div class="text-sm">{{ character.location.name }}</div>
              </div> -->

              <div
                class="whitespace-normal capitalize"
                title="Origin"
                *ngIf="character.origin.name"
              >
                <span
                  class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-20 mb-2 md:mb-0"
                  >Origin:</span
                >
                <span class="text-lg leading-none min-w-6 text-center mr-2"
                  >👶</span
                >
                <span class="text-sm">{{ character.origin.name }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <a
        [routerLink]="['/location', location?.id]"
        *ngIf="location"
        class="group w-full max-w-2xl relative border rounded-xl text-foreground transition-all p-6 flex flex-col gap-6 bg-input/50 overflow-hidden"
      >
        <h3
          class="font-semibold text-xl text-center md:text-left tracking-widest font-creepster flex items-center gap-2"
        >
          <span class="text-xl">📌</span>
          <span>Location</span>
        </h3>
        <div class="flex flex-col gap-2">
          <div class="whitespace-normal capitalize">
            <span
              class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-24 mb-2 md:mb-0"
              >Name:</span
            >
            <span class="text-lg leading-none min-w-6 text-center mr-2"
              >📍</span
            >
            <span class="text-sm">{{ location?.name }}</span>
          </div>

          <div class="whitespace-normal capitalize">
            <span
              class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-24 mb-2 md:mb-0"
              >Type:</span
            >
            <span class="text-lg leading-none min-w-6 text-center mr-2"
              >🪐</span
            >
            <span class="text-sm">{{ location?.type }}</span>
          </div>

          <div class="whitespace-normal capitalize">
            <span
              class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-24 mb-2 md:mb-0"
              >Dimension:</span
            >
            <span class="text-lg leading-none min-w-6 text-center mr-2"
              >🚀</span
            >
            <span class="text-sm">{{ location?.dimension }}</span>
          </div>

          <div class="whitespace-normal capitalize">
            <span
              class="text-muted-foreground text-sm inline-block w-full max-w-fauto md:max-w-24 mb-2 md:mb-0"
              >Residents:</span
            >
            <span class="text-lg leading-none min-w-6 text-center mr-2"
              >👽</span
            >
            <span class="text-sm">{{ location?.residents?.length }}</span>
          </div>
        </div>
      </a>

      <div
        *ngIf="episodes"
        class="group w-full max-w-2xl relative border rounded-xl text-foreground transition-all p-6 flex flex-col gap-6 bg-input/50 overflow-hidden"
      >
        <h3
          class="font-semibold text-xl text-center md:text-left tracking-widest font-creepster flex items-center gap-2"
        >
          <span class="text-xl">📽️</span>
          <span>Episodes</span>
        </h3>
        <div
          class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-96 overflow-auto pr-2"
        >
          <div
            class="w-full flex gap-2 items-stretch justify-stretch aspect-video"
            *ngFor="let episode of episodes"
          >
            <a
              [routerLink]="['/episode', episode?.id]"
              class="border overflow-hidden rounded-lg p-4 w-full justify-center items-center flex flex-col gap-1 text-center bg-background/60 hover:border-foreground/30 transition-all"
            >
              <span class="text-muted-foreground text-2xl">🎞️ </span>
              <div class="w-full">
                <span class="text-sm capitalize"
                  >{{ episode?.episode }} - {{ episode?.name }}</span
                >
              </div>
              <div
                class="w-full flex items-center justify-center flex-wrap gap-2"
              >
                <span class="text-muted-foreground text-lg">📺</span>
                <span class="text-xs text-muted-foreground capitalize">{{
                  episode?.air_date
                }}</span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<ng-template #empty>
  <div class="container text-center">
    <div
      class="p-10 min-h-[calc(100dvh-4rem-5rem)] flex gap-1 flex-col justify-center items-center"
    >
      <span class="text-2xl mb-2">👽😭💔</span>
      <h3 class="text-sm text-foreground">No character found!</h3>
      <span class="text-xs text-muted-foreground"
        >Please try searching again.</span
      >

      <a href="/" class="btn btn-white w-auto px-4 text-sm mt-4">
        <span class="text-lg">👈</span>
        <span>Back to home</span>
      </a>
    </div>
  </div>
</ng-template>

<ng-template #loading>
  <app-loading />
</ng-template>
